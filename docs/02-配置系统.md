# 配置系统

## 配置加载
- 组件：`pkg/config`
- 默认文件：`configs/config.yaml`
- 可选参数：启动时使用 `-config=/path/to/file` 覆盖
- 环境变量：前缀 `NOVA_`，点号替换为下划线（例：`NOVA_DATABASE_HOST`）

## 配置结构
```go
type Config struct {
    Server    ServerConfig
    Logger    LoggerConfig
    DB        DBConfig
    Redis     RedisConfig
    Auth      AuthConfig
    RateLimit RateLimitConfig
    Casbin    CasbinConfig
    Upload    UploadConfig
    Queue     QueueConfig
    AuditLog  AuditLogConfig
}
```

### ServerConfig
- `host`：监听地址
- `port`：端口
- `mode`：`debug` / `release`

### LoggerConfig
- `level`：日志级别，如 `info`
- `format`：`json` 或 `text`
- `output`：`stdout` 或 `file`
- `file_path`：文件路径（当 output=file）
- `max_size` / `max_backups` / `max_age`：日志轮转策略

### DBConfig
- `driver`：当前仅支持 `postgres`，填写其他值将导致连接串生成失败。
- `host` / `port` / `user` / `password` / `dbname`
- `charset`：MySQL 使用
- `max_idle` / `max_open`：连接池
- 方法 `GetDSN()` 根据 driver 生成连接串

### RedisConfig
- 基础连接参数
- `pool_size`：最大连接数
- `min_idle_conns`：最小空闲连接
- `max_retries`：重试次数

### AuthConfig
- `jwt_secret`
- `access_token_duration`：秒
- `refresh_token_duration`：秒
- `issuer`：签发方

### RateLimitConfig
- `enabled`
- `algorithm`：`token_bucket` 或 `sliding_window`
- `ip_limit` / `ip_window`
- `user_limit` / `user_window`

### CasbinConfig
- `model_path`：如 `configs/rbac_model.conf`
- `auto_save`：更新策略后立即写入
- `auto_load`：是否定时重载策略
- `auto_load_tick`：重载间隔秒

### UploadConfig
- `storage_type`：`local` / `oss` / `s3`
- `max_size`：MB
- `allowed_types` / `allowed_exts`
- 本地配置：`local_path`、`local_url`
- 缩略图：`enable_thumbnail`、尺寸、质量
- OSS / S3 参数：根据需要启用

### QueueConfig
- `enabled`
- `workers`：并发 Worker 数
- `max_retry`
- `retry_delay`：秒
- `redis_prefix`
- `poll_interval`

示例：
```yaml
queue:
    enabled: true
    workers: 4
    max_retry: 3
    retry_delay: 30
    redis_prefix: nova
    poll_interval: 5
```

### AuditLogConfig
- `enabled`
- `log_request` / `log_response`
- `max_body_size`
- `exclude_paths`
- `include_actions`（TODO：中间件暂未实现该筛选）
- `sensitive_fields`

## 生产环境建议
- 为生产环境准备 `config.prod.yaml`，通过 `-config` 指定
- 将敏感信息写入环境变量，避免明文提交
- 配置文件中保留注释说明，但不要依赖注释读取逻辑

## 配置获取
- 初始化后 `config.Get()` 返回全局指针
- `Config.GetServerAddr()` 拼接 `host:port`

掌握此结构后，可快速扩展配置项并在运行时读取使用。